<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Queries Catalog :: Neo4j Code Graph</title>
    <meta name="generator" content="Antora 3.1.12">
<link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
<link rel="icon" type="image/svg+xml" href="../../../_/img/favicon.svg">
<link rel="alternate icon" href="../../../_/img/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="../../../_/img/apple-touch-icon.png">
  </head>
  <body class="article">
<nav class="navbar">
  <div class="navbar-brand">
    <a class="navbar-item" href="../../../">Neo4j Code Graph</a>
  </div>
  <div class="navbar-menu"></div>
</nav>
<div class="body">
<div class="nav-container" data-component="neo4j-code-graph" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Docs</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">User Guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guide.html">Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration.html">Configuration</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="index.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../requirements.html">Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../graph-model.html">Graph model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../references.html">References</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Developer Guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../project-structure.html">Project Structure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development.html">Development</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Docs</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">Docs</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Docs</a></li>
    <li>User Guide</li>
    <li><a href="index.html">Queries</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/alexwoolford/neo4j-code-graph/edit/main/docs/modules/ROOT/pages/queries/index.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Queries Catalog</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section lists example queries with references to tagged Cypher snippets.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_co_change_pairs"><a class="anchor" href="#_co_change_pairs"></a>Co-change pairs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Execute this in Neo4j Browser or Bloom to list top co-changed file pairs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (f1:File)-[cc:CO_CHANGED]-&gt;(f2:File)
WHERE cc.support &gt;= 5 AND cc.confidence &gt;= 0.6
RETURN f1.path AS f1, f2.path AS f2, cc.support AS support, cc.confidence AS confidence
ORDER BY confidence DESC, support DESC
LIMIT 25</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_risk"><a class="anchor" href="#_security_risk"></a>Security &amp; Risk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_customer_facing_apis_using_vulnerable_dependencies"><a class="anchor" href="#_customer_facing_apis_using_vulnerable_dependencies"></a>Customer-facing APIs using vulnerable dependencies</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (cve:CVE)-[:AFFECTS]-&gt;(dep:ExternalDependency)&lt;-[:DEPENDS_ON]-(i:Import)&lt;-[:IMPORTS]-(f:File)
MATCH (f)-[:DECLARES]-&gt;(m:Method)
WHERE m.is_public = true AND cve.cvss_score &gt;= 7.0
RETURN f.path, m.class_name, m.name, cve.id, cve.cvss_score
ORDER BY cve.cvss_score DESC</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dependency_risk_summary"><a class="anchor" href="#_dependency_risk_summary"></a>Dependency risk summary</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (dep:ExternalDependency)
OPTIONAL MATCH (dep)&lt;-[:AFFECTS]-(cve:CVE)
OPTIONAL MATCH (dep)&lt;-[:DEPENDS_ON]-(i:Import)&lt;-[:IMPORTS]-(f:File)
RETURN dep.package, dep.version,
       count(DISTINCT cve) as vulnerabilities,
       count(DISTINCT f) as files_using_it,
       max(cve.cvss_score) as worst_cvss_score
ORDER BY vulnerabilities DESC, files_using_it DESC</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture_technical_debt"><a class="anchor" href="#_architecture_technical_debt"></a>Architecture &amp; Technical Debt</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_refactor_candidates"><a class="anchor" href="#_refactor_candidates"></a>Refactor candidates</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (f:File)
WHERE f.total_lines &gt; 500 AND f.method_count &gt; 20
OPTIONAL MATCH (f)-[:IMPORTS]-&gt;(i:Import)-[:DEPENDS_ON]-&gt;(dep:ExternalDependency)&lt;-[:AFFECTS]-(cve:CVE)
WHERE cve.cvss_score &gt;= 7.0
RETURN f.path, f.total_lines, f.method_count, f.class_count,
       count(DISTINCT cve) as security_issues,
       (f.total_lines * f.method_count + count(cve)*100) as priority_score
ORDER BY priority_score DESC
LIMIT 25</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_architectural_bottlenecks"><a class="anchor" href="#_architectural_bottlenecks"></a>Architectural bottlenecks</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (m:Method)
WHERE m.pagerank_score IS NOT NULL AND m.pagerank_score &gt; 0.001
MATCH (m)&lt;-[:DECLARES]-(f:File)
RETURN f.path, m.class_name, m.name,
       m.pagerank_score as importance,
       m.estimated_lines as complexity
ORDER BY m.pagerank_score DESC
LIMIT 20</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_top_central_methods_pagerank"><a class="anchor" href="#_top_central_methods_pagerank"></a>Top central methods (PageRank)</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">// Top methods by PageRank (requires centrality task write-back)
MATCH (m:Method)
WHERE m.pagerank_score IS NOT NULL
RETURN m.method_signature AS method,
       m.class_name       AS class,
       m.file             AS file,
       m.pagerank_score   AS score
ORDER BY score DESC, file, class, method
LIMIT 25</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_validate_louvain_community_write_back"><a class="anchor" href="#_validate_louvain_community_write_back"></a>Validate Louvain community write-back</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">// Validate Louvain write-back on similarity communities (if previously run)
MATCH (m:Method)
WHERE m.similarity_community IS NOT NULL
RETURN m.similarity_community AS community,
       count(*)               AS members
ORDER BY members DESC, community
LIMIT 10</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_high_blast_radius_methods_prioritize_testingrefactoring"><a class="anchor" href="#_high_blast_radius_methods_prioritize_testingrefactoring"></a>High-blast-radius methods (prioritize testing/refactoring)</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">// High-impact targets for testing/refactoring: central methods called from many packages
// Value: prioritize changes where a defect has the widest blast radius across teams/modules.
MATCH (m:Method)
WHERE m.pagerank_score IS NOT NULL
OPTIONAL MATCH (caller:Method)-[:CALLS]-&gt;(m)
OPTIONAL MATCH (caller)&lt;-[:CONTAINS_METHOD]-(callerClass:Class)&lt;-[:CONTAINS]-(callerPkg:Package)
WITH m,
     count(DISTINCT caller) AS callers,
     count(DISTINCT callerPkg.name) AS caller_packages
RETURN m.method_signature AS method,
       m.pagerank_score   AS centrality,
       callers,
       caller_packages
ORDER BY centrality DESC, caller_packages DESC, callers DESC
LIMIT 25</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_community_to_module_mapping_candidates"><a class="anchor" href="#_community_to_module_mapping_candidates"></a>Community-to-module mapping candidates</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">// Candidate modules from similarity communities
// Value: reveal cohesive clusters that can map to modules or ownership boundaries.
MATCH (m:Method)
WHERE m.similarity_community IS NOT NULL
OPTIONAL MATCH (m)&lt;-[:CONTAINS_METHOD]-(c:Class)&lt;-[:CONTAINS]-(p:Package)
WITH m.similarity_community AS community,
     count(*)               AS members,
     count(DISTINCT c)      AS classes,
     count(DISTINCT p)      AS packages
RETURN community, members, classes, packages
ORDER BY members DESC, packages ASC
LIMIT 20</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fractured_classes_spanning_multiple_communities"><a class="anchor" href="#_fractured_classes_spanning_multiple_communities"></a>Fractured classes spanning multiple communities</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">// Classes whose methods span multiple communities (potential split/refactor candidates)
// Value: identify units where responsibilities are mixed across unrelated clusters.
MATCH (cls:Class)-[:CONTAINS_METHOD]-&gt;(m:Method)
WHERE m.similarity_community IS NOT NULL
WITH cls,
     count(DISTINCT m.similarity_community) AS distinct_communities,
     count(m) AS methods,
     apoc.coll.toSet(collect(DISTINCT m.similarity_community))[..5] AS sample
WHERE distinct_communities &gt;= 2
RETURN cls.name AS class,
       cls.file AS file,
       methods,
       distinct_communities,
       sample AS communities
ORDER BY distinct_communities DESC, methods DESC
LIMIT 25</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_churn_weighted_package_risk_fanout_churn"><a class="anchor" href="#_churn_weighted_package_risk_fanout_churn"></a>Churn-weighted package risk (fanout × churn)</h3>
<div class="paragraph">
<p>Highlights namespaces that both change frequently and depend on many other packages (integration hubs with larger blast radius).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">// Churn-weighted package risk: packages that change often and depend on many packages
MATCH (p:Package)-[:CONTAINS]-&gt;(:Class)&lt;-[:DEFINES]-(f:File)
MATCH (c:Commit)-[:CHANGED]-&gt;(fv:FileVer)-[:OF_FILE]-&gt;(f)
WITH p, count(c) AS churn
MATCH (p)-[:CONTAINS]-&gt;(:Class)-[:CONTAINS_METHOD]-&gt;(m:Method)
MATCH (m)-[:CALLS]-&gt;(m2:Method)
MATCH (q:Package)-[:CONTAINS]-&gt;(:Class)-[:CONTAINS_METHOD]-&gt;(m2)
WHERE p &lt;&gt; q
WITH p, churn, count(DISTINCT q) AS fanoutPkgs
RETURN p.name AS package, churn, fanoutPkgs, churn*fanoutPkgs AS riskScore
ORDER BY riskScore DESC
LIMIT 15</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_implementations_of_an_interface"><a class="anchor" href="#_implementations_of_an_interface"></a>Implementations of an interface</h3>
<div class="paragraph">
<p>Useful when reviewing API coverage or locating implementers before refactoring.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">// List classes that implement a given interface
// Params: $interface (e.g., 'Runnable')
MATCH (i:Interface {name: $interface})
MATCH (c:Class)-[:IMPLEMENTS]-&gt;(i)
RETURN i.name AS interface, c.name AS class, c.file AS file
ORDER BY interface, class</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interfaces_without_implementations"><a class="anchor" href="#_interfaces_without_implementations"></a>Interfaces without implementations</h3>
<div class="paragraph">
<p>Find potentially dead or library-only interfaces to prune or document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">// Interfaces with no implementing classes (useful to spot dead/SDK-only contracts)
MATCH (i:Interface)
WHERE NOT ( (:Class)-[:IMPLEMENTS]-&gt;(i) )
RETURN i.name AS interface, i.file AS file
ORDER BY interface</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_team_process"><a class="anchor" href="#_team_process"></a>Team &amp; Process</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_experts_for_a_module"><a class="anchor" href="#_experts_for_a_module"></a>Experts for a module</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (dev:Developer)-[:AUTHORED]-&gt;(commit:Commit)-[:CHANGED]-&gt;(fv:FileVer)-[:OF_FILE]-&gt;(f:File)
WHERE f.path CONTAINS $module
WITH dev, f, count(DISTINCT commit) as commits_to_file
WHERE commits_to_file &gt;= 3
RETURN dev.name, dev.email,
       count(DISTINCT f) as files_touched,
       sum(commits_to_file) as total_commits
ORDER BY total_commits DESC
LIMIT 10</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_most_changed_files_by_churn"><a class="anchor" href="#_most_changed_files_by_churn"></a>Most changed files by churn</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">// Most changed files by total line churn (additions + deletions)
MATCH (c:Commit)-[r:CHANGED]-&gt;(fv:FileVer)-[:OF_FILE]-&gt;(f:File)
WITH f.path AS path,
     count(*) AS changes,
     sum(coalesce(r.additions, 0)) AS adds,
     sum(coalesce(r.deletions, 0)) AS dels,
     sum(coalesce(r.additions, 0) + coalesce(r.deletions, 0)) AS churn
RETURN path, changes, adds, dels, churn
ORDER BY churn DESC
LIMIT 25</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_find_documentation_attached_to_methods_or_classes"><a class="anchor" href="#_find_documentation_attached_to_methods_or_classes"></a>Find documentation attached to methods or classes</h3>
<div class="paragraph">
<p>Use HAS_DOC to surface docstrings/comments linked to code elements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">// Methods and their attached docs
MATCH (m:Method)-[:HAS_DOC]-&gt;(d:Doc)
RETURN m.method_signature AS method, d.text AS doc, d.start_line AS start, d.end_line AS end
ORDER BY method, start</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">// Classes and their attached docs
MATCH (c:Class)-[:HAS_DOC]-&gt;(d:Doc)
RETURN c.name AS class, c.file AS file, d.text AS doc, d.start_line AS start
ORDER BY file, class, start</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_top_complex_methods_cyclomatic_complexity"><a class="anchor" href="#_top_complex_methods_cyclomatic_complexity"></a>Top complex methods (cyclomatic complexity)</h3>
<div class="paragraph">
<p>Identify potentially complex hotspots using the <code>cyclomatic_complexity</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (m:Method)
WHERE m.cyclomatic_complexity IS NOT NULL
RETURN m.name AS method, m.file AS file, m.cyclomatic_complexity AS cc
ORDER BY cc DESC, file, method
LIMIT 25</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deprecated_methods_and_their_callers"><a class="anchor" href="#_deprecated_methods_and_their_callers"></a>Deprecated methods and their callers</h3>
<div class="paragraph">
<p>Identify deprecated APIs and where they are called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (d:Method {deprecated:true})
OPTIONAL MATCH (caller:Method)-[:CALLS]-&gt;(d)
RETURN d.class_name AS class, d.name AS method, d.deprecated_since AS since,
       count(caller) AS callers
ORDER BY callers DESC, class, method</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_risk_2"><a class="anchor" href="#_security_risk_2"></a>Security &amp; Risk</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_release_risk_assessment"><a class="anchor" href="#_release_risk_assessment"></a>Release risk assessment</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cypher hljs" data-lang="cypher">MATCH (f:File)&lt;-[:OF_FILE]-(fv:FileVer)&lt;-[:CHANGED]-(c:Commit)
WHERE c.date &gt; datetime() - duration('P7D')
WITH f, count(c) as recent_changes
WHERE recent_changes &gt; 0
OPTIONAL MATCH (f)-[:IMPORTS]-&gt;(i:Import)-[:DEPENDS_ON]-&gt;(dep:ExternalDependency)&lt;-[:AFFECTS]-(cve:CVE)
WHERE cve.cvss_score &gt;= 7.0
OPTIONAL MATCH (f)-[:DECLARES]-&gt;(m:Method {is_public: true})
RETURN f.path as path, recent_changes,
       count(DISTINCT cve) as security_risks,
       count(DISTINCT m) as public_api_methods,
       CASE
         WHEN count(DISTINCT cve) &gt; 0 AND count(DISTINCT m) &gt; 0 THEN "HIGH RISK"
         WHEN count(DISTINCT cve) &gt; 0 OR recent_changes &gt; 10 THEN "MEDIUM RISK"
         ELSE "LOW RISK"
       END as release_risk_level
ORDER BY recent_changes DESC</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<div class="footer"><div class="container"><p></p></div></div>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cypher.min.js"></script>
<script>try{ if(window.Prism){ window.Prism.highlightAll(); } }catch(e){}</script>
  </body>
</html>
